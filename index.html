<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SarkariSarthi Jobs</title>
  <style>
    body { font-family: sans-serif; background: #0d1117; color: #c9d1d9; padding: 20px; }
    .job { background: #161b22; border: 1px solid #30363d; padding: 15px; margin: 10px 0; border-radius: 8px; }
    .job h3 { margin: 0 0 5px; color: #58a6ff; }
    .filters { margin-bottom: 20px; }
    select, input[type="text"] { padding: 8px; margin-right: 10px; border-radius: 5px; border: none; }
    a { color: #58a6ff; text-decoration: none; }
  </style>
</head>
<body>
  <h1>ðŸ“‹ SarkariSarthi Jobs</h1>

  <div class="filters">
    <input type="text" id="search" placeholder="ðŸ” Search job titles..." />
    <select id="stateFilter">
      <option value="">All States</option>
    </select>
    <select id="categoryFilter">
      <option value="">All Categories</option>
    </select>
  </div>

  <div id="jobs">Loading jobs...</div>

  <script>
    const repoPath = "https://parya5103.github.io/sarkarisarthi/jobs/";

    const jobContainer = document.getElementById("jobs");
    const searchInput = document.getElementById("search");
    const stateFilter = document.getElementById("stateFilter");
    const categoryFilter = document.getElementById("categoryFilter");

    let allJobs = [];

    // âœ… Dynamically list all known JSON files (static list or via auto update script)
    const jobFiles = [
      "government-jobs.json", "defence-jobs.json", "railway-jobs.json",
      "psc-jobs.json", "bank-jobs.json", "teaching-jobs.json",
      "state-govt-jobs.json", "medical-jobs.json", "ssc-chsl-recruitment-2025.json",
      "upsc-recruitment-test-(rt)-for-personal-assistant.json",
      "bihar-prd-technical-assistant-recruitment-2025.json"
      // âž• Add more .json filenames here or auto-generate this list via script
    ];

    async function loadAllJobs() {
      allJobs = [];

      const promises = jobFiles.map(file =>
        fetch(repoPath + file)
          .then(res => res.ok ? res.json() : [])
          .catch(() => [])
      );

      const allResults = await Promise.all(promises);
      allResults.forEach(jobs => allJobs.push(...jobs));
      renderJobs(allJobs);
      populateFilters(allJobs);
    }

    function renderJobs(jobs) {
      if (!jobs.length) {
        jobContainer.innerHTML = "<p>ðŸ˜” No jobs found.</p>";
        return;
      }

      jobContainer.innerHTML = "";
      jobs.forEach(job => {
        const div = document.createElement("div");
        div.className = "job";
        div.innerHTML = `
          <h3>${job.title || "No Title"}</h3>
          <p><strong>Department:</strong> ${job.department || "N/A"}</p>
          <p><strong>Location:</strong> ${job.state || job.location || "All India"}</p>
          ${job.pdf ? `<p><a href="${job.pdf}" target="_blank">ðŸ“„ View Notification</a></p>` : ""}
          ${job.link ? `<p><a href="${job.link}" target="_blank">âœ… Apply Now</a></p>` : ""}
        `;
        jobContainer.appendChild(div);
      });
    }

    function populateFilters(jobs) {
      const states = [...new Set(jobs.map(j => j.state).filter(Boolean))].sort();
      const categories = [...new Set(jobs.map(j => j.department).filter(Boolean))].sort();

      states.forEach(state => {
        const option = document.createElement("option");
        option.value = state;
        option.textContent = state;
        stateFilter.appendChild(option);
      });

      categories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        categoryFilter.appendChild(option);
      });
    }

    function applyFilters() {
      const query = searchInput.value.toLowerCase();
      const state = stateFilter.value;
      const dept = categoryFilter.value;

      const filtered = allJobs.filter(job => {
        const matchTitle = job.title?.toLowerCase().includes(query);
        const matchState = state ? job.state === state : true;
        const matchDept = dept ? job.department === dept : true;
        return matchTitle && matchState && matchDept;
      });

      renderJobs(filtered);
    }

    searchInput.addEventListener("input", applyFilters);
    stateFilter.addEventListener("change", applyFilters);
    categoryFilter.addEventListener("change", applyFilters);

    loadAllJobs();
  </script>
</body>
</html>
